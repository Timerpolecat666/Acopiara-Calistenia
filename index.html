<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Acopiara Calistenia ‚Äî Cronograma</title>
  <link rel="icon" href="assets/images/dumbell.png" />
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-900 text-slate-100 antialiased">
  <div id="root"></div>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Firebase compat -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBWh9FOM2VHkenakxccSauyPkcBXSMZ-AQ",
      authDomain: "acopiara-calistenia.firebaseapp.com",
      projectId: "acopiara-calistenia",
      storageBucket: "acopiara-calistenia.appspot.com",
      messagingSenderId: "78878692910",
      appId: "1:78878692910:web:5a334cf12e7b84be5f71bf"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
  </script>

  <script>
    const { useState, useEffect, createElement: h } = React;

    function App() {
      const users = ['Erick', 'Gabriel', 'Brendo', 'Jonas', 'Leonardo'];
      const days = ['Segunda', 'Ter√ßa', 'Quarta', 'Quinta', 'Sexta'];

      const [schedule, setSchedule] = useState({});

      // üî¥ ESCUTA EM TEMPO REAL
      useEffect(() => {
        const unsub = db.collection('cronograma').doc('semana-atual')
          .onSnapshot(doc => {
            if (doc.exists) {
              setSchedule(doc.data());
            } else {
              const init = {};
              users.forEach(u => {
                init[u] = {};
                days.forEach(d => init[u][d] = { text: '', status: 'none' });
              });
              db.collection('cronograma').doc('semana-atual').set(init);
            }
          });
        return () => unsub();
      }, []);

      // üî¥ SALVA NO FIRESTORE
      const save = (data) => {
        db.collection('cronograma').doc('semana-atual').set(data);
      };

      const updateText = (u, d, v) => {
        const next = structuredClone(schedule);
        next[u][d].text = v;
        setSchedule(next);
        save(next);
      };

      const toggleStatus = (u, d, s) => {
        const next = structuredClone(schedule);
        next[u][d].status = next[u][d].status === s ? 'none' : s;
        setSchedule(next);
        save(next);
      };

      if (!Object.keys(schedule).length) {
        return h('div', { className: 'p-6 text-center' }, 'Carregando‚Ä¶');
      }

      return h('div', { className: 'p-4 max-w-7xl mx-auto space-y-6' },
        h('header', { className: 'flex items-center gap-3 border-b border-slate-700 pb-4' },
          h('img', { src: 'assets/images/dumbell.png', className: 'w-10 h-10' }),
          h('h1', { className: 'text-xl font-bold' }, 'Acopiara Calistenia')
        ),

        h('div', { className: 'overflow-x-auto' },
          h('table', { className: 'w-full min-w-[800px] border-collapse' },
            h('thead', null,
              h('tr', { className: 'bg-slate-800 text-xs uppercase' },
                h('th', { className: 'p-2 border border-slate-700' }, 'Atleta'),
                ...days.map(d => h('th', { key: d, className: 'p-2 border border-slate-700' }, d))
              )
            ),
            h('tbody', null,
              users.map(u => h('tr', { key: u },
                h('td', { className: 'p-2 text-emerald-400 border border-slate-700' }, u),
                ...days.map(d => h('td', { key: d, className: 'p-2 border border-slate-700' },
                  h('textarea', {
                    className: 'w-full h-16 bg-transparent border border-slate-600 p-1 text-sm',
                    value: schedule[u][d].text,
                    onChange: e => updateText(u, d, e.target.value)
                  }),
                  h('div', { className: 'flex gap-1 justify-end' },
                    h('button', { onClick: () => toggleStatus(u, d, 'completed') }, '‚úÖ'),
                    h('button', { onClick: () => toggleStatus(u, d, 'partial') }, '‚ö†Ô∏è'),
                    h('button', { onClick: () => toggleStatus(u, d, 'missed') }, '‚ùå')
                  )
                ))
              ))
            )
          )
        )
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(h(App));
  </script>
</body>
</html>
